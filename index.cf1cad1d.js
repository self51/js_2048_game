const t=new class{constructor(t=this.getNewBoard()){this.state=t,this.initialState=this.copyState(t),this.prevState=this.copyState(this.state),this.status="idle",this.score=0,this.isWin=!1}moveLeft(){this.makeMove(()=>{for(let t=0;t<4;t++){let e=this.state[t],s=this.moveLine(e);this.state[t]=s}})}moveRight(){this.makeMove(()=>{for(let t=0;t<4;t++){let e=this.state[t].reverse(),s=this.moveLine(e);this.state[t]=s.reverse()}})}moveUp(){this.makeMove(()=>{for(let t=0;t<4;t++){let e=this.getRow(t),s=this.moveLine(e);this.changeRow(s,t)}})}moveDown(){this.makeMove(()=>{for(let t=0;t<4;t++){let e=this.getRow(t),s=this.moveLine(e.reverse());this.changeRow(s.reverse(),t)}})}getScore(){return this.score}updateScore(t){this.score+=t}getLineSum(t){return t.reduce((t,e)=>t+e,0)}getState(){return this.state}getPrevState(){return this.prevState}setPrevState(){this.prevState=this.copyState(this.state)}copyState(t){return t.map(t=>[...t])}getStatus(){return this.status}setStatus(t){this.status=t}updateStatus(){this.isLose()&&this.setStatus("lose"),this.isWin&&this.setStatus("win")}start(){this.addRandomCell(),this.addRandomCell(),this.setStatus("playing")}restart(){this.state=this.copyState(this.initialState),this.score=0,this.setStatus("idle")}getNewBoard(){return[void 0,void 0,void 0,void 0].map(()=>[,,,,].fill(0))}makeMove(t){let e=this.getStatus();"idle"!==e&&"lose"!==e&&(this.setPrevState(),t(),this.isMoved(this.getPrevState())&&this.addRandomCell(),this.updateStatus())}moveLine(t){let e=t.filter(t=>0!==t);for(let t=0;t<e.length;t++){let s=e[t],i=e[t+1];if(s===i){let r=s+i;e.splice(t,1,r),e.splice(t+1,1),this.updateScore(s+i),2048===r&&(this.isWin=!0)}}for(;4!==e.length;)e.push(0);return e}addRandomCell(){let t=this.getEmptyCells();if(0!==t.length){let e=Math.floor(Math.random()*t.length),s=t[e];this.state[s.rowIndex][s.colIndex]=.9>Math.random()?2:4}}getRow(t){let e=[];for(let s=0;s<4;s++){let i=this.state[s][t];e.push(i)}return e}changeRow(t,e){for(let s=0;s<4;s++)this.state[s][e]=t[s]}getEmptyCells(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push({rowIndex:e,colIndex:s});return t}isMoved(t){for(let e=0;e<4;e++)for(let s=0;s<4;s++)if(t[e][s]!==this.state[e][s])return!0;return!1}isLose(){for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.state[t][e],i=t+1<4?this.state[t+1][e]:-1,r=e+1<4?this.state[t][e+1]:-1,a=0===s||0===i||0===r;if(s===i|s===r||a)return!1}return!0}drawBoard(t){this.state.forEach((e,s)=>{e.forEach((e,i)=>{let r=t[4*s+i];0!==e?(r.textContent=e,r.classList=`field-cell field-cell--${e}`):(r.textContent=null,r.classList="field-cell")})})}},e=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],s=document.querySelector(".button"),i=document.querySelector(".game-score"),r=document.querySelector(".message-start"),a=document.querySelector(".message-lose"),o=document.querySelector(".message-win"),l=document.querySelectorAll(".field-cell");function n(){switch(t.getStatus()){case"win":o.classList.remove("hidden");break;case"lose":a.classList.remove("hidden");break;case"playing":o.classList.contains("hidden")||o.classList.add("hidden"),a.classList.contains("hidden")||a.classList.add("hidden")}}s.addEventListener("click",function(){"Start"===s.textContent?(t.start(),s.textContent="Restart",s.classList.toggle("restart"),r.classList.toggle("hidden")):(t.restart(),t.start(),n()),t.drawBoard(l)}),document.addEventListener("keydown",s=>{e.includes(s.key)&&"lose"!==t.getStatus()&&(function(e){switch(e){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown()}}(s.key),i.textContent=t.getScore(),t.drawBoard(l),n())});
//# sourceMappingURL=index.cf1cad1d.js.map

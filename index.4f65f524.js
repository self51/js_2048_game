!function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function r(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,r)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var n=new(function(){var e,n;function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getNewBoard();!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,a),this.state=t,this.initialState=this.copyState(t),this.prevState=this.copyState(this.state),this.status="idle",this.score=0,this.isWin=!1}return e=[{key:"moveLeft",value:function(){var t=this;this.makeMove(function(){for(var e=0;e<4;e++){var r=t.state[e],n=t.moveLine(r);t.state[e]=n}})}},{key:"moveRight",value:function(){var t=this;this.makeMove(function(){for(var e=0;e<4;e++){var r=t.state[e].reverse(),n=t.moveLine(r);t.state[e]=n.reverse()}})}},{key:"moveUp",value:function(){var t=this;this.makeMove(function(){for(var e=0;e<4;e++){var r=t.getRow(e),n=t.moveLine(r);t.changeRow(n,e)}})}},{key:"moveDown",value:function(){var t=this;this.makeMove(function(){for(var e=0;e<4;e++){var r=t.getRow(e),n=t.moveLine(r.reverse());t.changeRow(n.reverse(),e)}})}},{key:"getScore",value:function(){return this.score}},{key:"updateScore",value:function(t){this.score+=t}},{key:"getLineSum",value:function(t){return t.reduce(function(t,e){return t+e},0)}},{key:"getState",value:function(){return this.state}},{key:"getPrevState",value:function(){return this.prevState}},{key:"setPrevState",value:function(){this.prevState=this.copyState(this.state)}},{key:"copyState",value:function(t){return t.map(function(t){return r(t)})}},{key:"getStatus",value:function(){return this.status}},{key:"setStatus",value:function(t){this.status=t}},{key:"updateStatus",value:function(){this.isLose()&&this.setStatus("lose"),this.isWin&&this.setStatus("win")}},{key:"start",value:function(){this.addRandomCell(),this.addRandomCell(),this.setStatus("playing")}},{key:"restart",value:function(){this.state=this.copyState(this.initialState),this.score=0,this.setStatus("idle")}},{key:"getNewBoard",value:function(){return r([,,,,]).map(function(){return[,,,,].fill(0)})}},{key:"makeMove",value:function(t){var e=this.getStatus();"idle"!==e&&"lose"!==e&&(this.setPrevState(),t(),this.isMoved(this.getPrevState())&&this.addRandomCell(),this.updateStatus())}},{key:"moveLine",value:function(t){for(var e=t.filter(function(t){return 0!==t}),r=0;r<e.length;r++){var n=e[r],a=e[r+1];if(n===a){var o=n+a;e.splice(r,1,o),e.splice(r+1,1),this.updateScore(n+a),2048===o&&(this.isWin=!0)}}for(;4!==e.length;)e.push(0);return e}},{key:"addRandomCell",value:function(){var t=this.getEmptyCells();if(0!==t.length){var e=Math.floor(Math.random()*t.length),r=t[e];this.state[r.rowIndex][r.colIndex]=.9>Math.random()?2:4}}},{key:"getRow",value:function(t){for(var e=[],r=0;r<4;r++){var n=this.state[r][t];e.push(n)}return e}},{key:"changeRow",value:function(t,e){for(var r=0;r<4;r++)this.state[r][e]=t[r]}},{key:"getEmptyCells",value:function(){for(var t=[],e=0;e<4;e++)for(var r=0;r<4;r++)0===this.state[e][r]&&t.push({rowIndex:e,colIndex:r});return t}},{key:"isMoved",value:function(t){for(var e=0;e<4;e++)for(var r=0;r<4;r++)if(t[e][r]!==this.state[e][r])return!0;return!1}},{key:"isLose",value:function(){for(var t=0;t<4;t++)for(var e=0;e<4;e++){var r=this.state[t][e],n=t+1<4?this.state[t+1][e]:-1,a=e+1<4?this.state[t][e+1]:-1,o=0===r||0===n||0===a;if(r===n|r===a||o)return!1}return!0}},{key:"drawBoard",value:function(t){this.state.forEach(function(e,r){e.forEach(function(e,n){var a=t[4*r+n];0!==e?(a.textContent=e,a.classList="field-cell field-cell--".concat(e)):(a.textContent=null,a.classList="field-cell")})})}}],t(a.prototype,e),n&&t(a,n),a}()),a=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],o=document.querySelector(".button"),i=document.querySelector(".game-score"),s=document.querySelector(".message-start"),u=document.querySelector(".message-lose"),c=document.querySelector(".message-win"),l=document.querySelectorAll(".field-cell");function v(){switch(n.getStatus()){case"win":c.classList.remove("hidden");break;case"lose":u.classList.remove("hidden");break;case"playing":c.classList.contains("hidden")||c.classList.add("hidden"),u.classList.contains("hidden")||u.classList.add("hidden")}}o.addEventListener("click",function(){"Start"===o.textContent?(n.start(),o.textContent="Restart",o.classList.toggle("restart"),s.classList.toggle("hidden")):(n.restart(),n.start(),v()),n.drawBoard(l)}),document.addEventListener("keydown",function(t){a.includes(t.key)&&"lose"!==n.getStatus()&&(function(t){switch(t){case"ArrowLeft":n.moveLeft();break;case"ArrowRight":n.moveRight();break;case"ArrowUp":n.moveUp();break;case"ArrowDown":n.moveDown()}}(t.key),i.textContent=n.getScore(),n.drawBoard(l),v())})}();
//# sourceMappingURL=index.4f65f524.js.map
